<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <title>Space Invaders - HTML5 Canvas</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <canvas id="game" aria-label="Space Invaders game canvas" role="img"></canvas>

    <!-- On-screen controls for touch devices -->
    <div id="controls" aria-hidden="true">
      <button id="btn-left" class="control-btn" aria-label="Move left">â—€</button>
      <button id="btn-right" class="control-btn" aria-label="Move right">â–¶</button>
      <button id="btn-mute" class="control-btn small" aria-label="Toggle mute" title="M to toggle">ðŸ”Š</button>
    </div>

    <!-- IMPORTANT: non-module script, after canvas -->
    <script src="invaders.js"></script>
  <!-- Show JS errors on-screen (so mobile can see them) -->
<script>
  window.onerror = function (msg, src, line, col) {
    const d = document.createElement('div');
    d.style.cssText = 'position:fixed;left:8px;bottom:8px;color:#7fffd4;font:12px monospace;white-space:pre-wrap;';
    d.textContent = String(msg) + (src ? `\n${src}:${line}:${col||0}` : '');
    document.body.appendChild(d);
    return false;
  };
</script>

<!-- Force-size the canvas and start the game -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const c = document.getElementById('game');
    if (!c) return;

    function sizeCanvas() {
      const dpr = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
      c.style.width  = window.innerWidth + 'px';
      c.style.height = window.innerHeight + 'px';
      c.width  = Math.floor(window.innerWidth  * dpr);
      c.height = Math.floor(window.innerHeight * dpr);
      const ctx = c.getContext('2d');
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    sizeCanvas();
    window.addEventListener('resize', sizeCanvas);

    // Start the game if Game() exists in invaders.js
    if (typeof Game === 'function') {
      try { new Game(c); } catch (e) {
        window.onerror(e && e.message ? e.message : e, 'invaders.js', 0, 0);
      }
    }
  });
</script>
  </body>
</html>
